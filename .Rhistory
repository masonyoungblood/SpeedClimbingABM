unlist(readRDS("_rslurm_1/results_2.RDS")),
unlist(readRDS("_rslurm_1/results_3.RDS")),
unlist(readRDS("_rslurm_1/results_4.RDS")))
setwd("~/Documents/Work/Summer_2021/Speed Climbing/SpeedClimbingABM/hpcc_output/simulations_w")
params_w <- readRDS("_rslurm_1/params.RDS")
results_w <- c(unlist(readRDS("_rslurm_1/results_0.RDS")),
unlist(readRDS("_rslurm_1/results_1.RDS")),
unlist(readRDS("_rslurm_1/results_2.RDS")),
unlist(readRDS("_rslurm_1/results_3.RDS")),
unlist(readRDS("_rslurm_1/results_4.RDS")))
#set working directory, load data, source code
setwd("~/Documents/Work/Summer_2021/Speed Climbing/SpeedClimbingABM")
load("hpcc_output/posteriors_m.RData")
load("hpcc_output/posteriors_w.RData")
load("hpcc_output/priors_m.RData")
load("hpcc_output/priors_w.RData")
load("data.RData")
grid <- read.csv("grid.csv")/1000
library(ggplot2)
library(ggplotify)
library(cowplot)
library(patchwork)
routes_norm_m_best <- lapply(1:length(posteriors_m$norm), function(x){posteriors_m$norm[[x]]$beta[[which.min(posteriors_m$norm[[x]]$current_record)]]})
routes_norm_m_common <- lapply(1:length(posteriors_m$norm), function(x){as.numeric(strsplit(names(sort(table(sapply(1:length(posteriors_m$norm[[x]]$beta), function(y){paste0(which(posteriors_m$norm[[x]]$beta[[y]]), collapse = " ")})), decreasing = TRUE)[1]), " ")[[1]])})
routes_norm_w_best <- lapply(1:length(posteriors_w$norm), function(x){posteriors_w$norm[[x]]$beta[[which.min(posteriors_w$norm[[x]]$current_record)]]})
routes_norm_w_common <- lapply(1:length(posteriors_w$norm), function(x){as.numeric(strsplit(names(sort(table(sapply(1:length(posteriors_w$norm[[x]]$beta), function(y){paste0(which(posteriors_w$norm[[x]]$beta[[y]]), collapse = " ")})), decreasing = TRUE)[1]), " ")[[1]])})
plot_route <- function(x, color, label, buff = 0.2){
#par(mar = c(0, 2.4, 0, 0.2))
par(mar = c(0, 0, 0, 0))
plot(grid$x, grid$y, axes = FALSE, ylab = "", xlab = "", main = label, col = "white", cex.main = 0.8,
xlim = c(min(grid$x)-buff, max(grid$x)+buff),
ylim = c(min(grid$y)-buff, max(grid$y)+buff))
if(typeof(x[[1]]) == "logical"){
for(i in 1:length(x)){
lines(x = jitter(grid[c(which(x[[i]]), 21), 1], 1.5),
y = jitter(grid[c(which(x[[i]]), 21), 2], 1.5), col = rgb(0, 0, 0, alpha = 0.002),
ylab = NULL, xlab = NULL)
}
}
if(typeof(x[[1]]) == "double"){
for(i in 1:length(x)){
lines(x = jitter(grid[c(x[[i]], 21), 1], 1.5),
y = jitter(grid[c(x[[i]], 21), 2], 1.5), col = rgb(0, 0, 0, alpha = 0.002),
ylab = NULL, xlab = NULL)
}
}
points(grid$x, grid$y, col = c(rep(color, 20), color), pch = c(rep(19, 20), 17), cex = c(rep(1.5, 20), 2),
ylab = NULL, xlab = NULL)
box()
#axis(side = 2, pos = 0, at = grid$y[-nrow(grid)], labels = 1:(nrow(grid)-1), cex.axis = 0.75, las = 2)
}
png("common_routes_m.png", width = 2, height = 10, units = "in", res = 300)
plot_route(routes_norm_m_best[1:1000], "red", "")
dev.off()
png("common_routes_w.png", width = 2, height = 10, units = "in", res = 300)
plot_route(routes_norm_w_best[1:1000], "blue", "")
dev.off()
png("holds_skipped.png", width = 6, height = 3, units = "in", res = 300)
barplot_data <- table((20-c(lengths(routes_norm_m_common), lengths(routes_norm_w_common))), as.factor(c(rep(0, length(routes_norm_m_common)), rep(1, length(routes_norm_w_common)))))
par(mar = c(3, 2, 0.2, 0), mgp = c(2, 1, 0))
barplot(barplot_data,
xlab = "# Holds Skipped",
col = c(rep("red", nrow(barplot_data)), rep("blue", nrow(barplot_data))),
beside = TRUE,
names.arg = c(rep(c(1:9), 2)))
dev.off()
plot_post <- function(x, n, alpha_w, alpha){
if(x == "M"){
par(mar = c(3, 2, 0.2, 0), mgp = c(2, 1, 0))
plot(density(data$time[which(data$gender == "M" & data$year == "2019")], bw = "SJ", kernel = "gaussian"), xlim = c(0, 25), main = "", ylab = "", xlab = "", col = "white")
for(i in 1:n){lines(density(priors_m[[i]]$current_record, bw = "SJ", kernel = "gaussian"), col = scales::alpha("gray88", 1))}
for(i in 1:n){lines(density(posteriors_m$norm[[i]]$current_record, bw = "SJ", kernel = "gaussian"), col = scales::alpha("white", alpha_w))}
for(i in 1:n){lines(density(posteriors_m$norm[[i]]$current_record, bw = "SJ", kernel = "gaussian"), col = scales::alpha("red", alpha))}
lines(density(data$time[which(data$gender == "M" & data$year == "2019")], bw = "SJ", kernel = "gaussian"), lwd = 1.5, col = "black")
}
if(x == "W"){
par(mar = c(3, 2, 0.2, 0), mgp = c(2, 1, 0))
plot(density(data$time[which(data$gender == "W" & data$year == "2019")], bw = "SJ", kernel = "gaussian"), xlim = c(0, 25), main = "", ylab = "", xlab = "Climbing Times (s)", col = "white")
for(i in 1:n){lines(density(priors_w[[i]]$current_record, bw = "SJ", kernel = "gaussian"), col = scales::alpha("gray88", 1))}
for(i in 1:n){lines(density(posteriors_w$norm[[i]]$current_record, bw = "SJ", kernel = "gaussian"), col = scales::alpha("white", alpha_w))}
for(i in 1:n){lines(density(posteriors_w$norm[[i]]$current_record, bw = "SJ", kernel = "gaussian"), col = scales::alpha("blue", alpha))}
lines(density(data$time[which(data$gender == "W" & data$year == "2019")], bw = "SJ", kernel = "gaussian"), lwd = 1.5, col = "black")
}
}
png("posterior_m.png", width = 6, height = 3, units = "in", res = 300)
plot_post("M", 4000, 0.02, 0.002)
dev.off()
png("posterior_w.png", width = 6, height = 3, units = "in", res = 300)
plot_post("W", 4000, 0.02, 0.002)
dev.off()
plot_a <- plot_grid((ggdraw() + draw_image("posterior_w.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped_m.png")
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_b
plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
png("posterior_bizniz.png", width = 5, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, plot_c, labels = c("", "C"), nrow = 1, rel_widths = c(1, 1))
dev.off()
png("posterior_bizniz.png", width = 5, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, plot_c, labels = c("", "C"), nrow = 1, rel_widths = c(1, 0.6))
dev.off()
png("posterior_bizniz.png", width = 5, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, plot_c, labels = c("", "C"), nrow = 1, rel_widths = c(1, 0.4))
dev.off()
png("posterior_bizniz.png", width = 5, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, plot_c, labels = c("", "C"), nrow = 1, rel_widths = c(1, 0.5))
dev.off()
png("posterior_bizniz.png", width = 5, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, plot_c, labels = c("", "C"), nrow = 1, rel_widths = c(1, 0.7))
dev.off()
png("posterior_bizniz.png", width = 5, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, plot_c, labels = c("", "C"), nrow = 1, rel_widths = c(1, 0.8))
dev.off()
png("posterior_bizniz.png", width = 5, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, plot_c, labels = c("", "C"), nrow = 1, rel_widths = c(1, 1))
dev.off()
png("posterior_bizniz.png", width = 5.5, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, plot_c, labels = c("", "C"), nrow = 1, rel_widths = c(1, 1))
dev.off()
png("posterior_bizniz.png", width = 6, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, plot_c, labels = c("", "C"), nrow = 1, rel_widths = c(1, 0.8))
dev.off()
png("common_routes_m.png", width = 2, height = 10, units = "in", res = 300)
par(mar = c(4, 0, 0, 0))
plot_route(routes_norm_m_best[1:1000], "red", "")
dev.off()
png("posterior_bizniz.png", width = 6, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, plot_c, labels = c("", "C"), nrow = 1, rel_widths = c(1, 0.8))
dev.off()
plot_route <- function(x, color, label, buff = 0.2){
#par(mar = c(0, 2.4, 0, 0.2))
plot(grid$x, grid$y, axes = FALSE, ylab = "", xlab = "", main = label, col = "white", cex.main = 0.8,
xlim = c(min(grid$x)-buff, max(grid$x)+buff),
ylim = c(min(grid$y)-buff, max(grid$y)+buff))
if(typeof(x[[1]]) == "logical"){
for(i in 1:length(x)){
lines(x = jitter(grid[c(which(x[[i]]), 21), 1], 1.5),
y = jitter(grid[c(which(x[[i]]), 21), 2], 1.5), col = rgb(0, 0, 0, alpha = 0.002),
ylab = NULL, xlab = NULL)
}
}
if(typeof(x[[1]]) == "double"){
for(i in 1:length(x)){
lines(x = jitter(grid[c(x[[i]], 21), 1], 1.5),
y = jitter(grid[c(x[[i]], 21), 2], 1.5), col = rgb(0, 0, 0, alpha = 0.002),
ylab = NULL, xlab = NULL)
}
}
points(grid$x, grid$y, col = c(rep(color, 20), color), pch = c(rep(19, 20), 17), cex = c(rep(1.5, 20), 2),
ylab = NULL, xlab = NULL)
box()
#axis(side = 2, pos = 0, at = grid$y[-nrow(grid)], labels = 1:(nrow(grid)-1), cex.axis = 0.75, las = 2)
}
png("common_routes_m.png", width = 2, height = 10, units = "in", res = 300)
par(mar = c(4, 0, 0, 0))
plot_route(routes_norm_m_best[1:1000], "red", "")
dev.off()
png("common_routes_m.png", width = 2, height = 10, units = "in", res = 300)
par(mar = c(0, 4, 0, 0))
plot_route(routes_norm_m_best[1:1000], "red", "")
dev.off()
plot_route <- function(x, color, label, buff = 0.2){
#par(mar = c(0, 2.4, 0, 0.2))
par(mar = c(0, 0, 0, 0))
plot(grid$x, grid$y, axes = FALSE, ylab = "", xlab = "", main = label, col = "white", cex.main = 0.8,
xlim = c(min(grid$x)-buff, max(grid$x)+buff),
ylim = c(min(grid$y)-buff, max(grid$y)+buff))
if(typeof(x[[1]]) == "logical"){
for(i in 1:length(x)){
lines(x = jitter(grid[c(which(x[[i]]), 21), 1], 1.5),
y = jitter(grid[c(which(x[[i]]), 21), 2], 1.5), col = rgb(0, 0, 0, alpha = 0.002),
ylab = NULL, xlab = NULL)
}
}
if(typeof(x[[1]]) == "double"){
for(i in 1:length(x)){
lines(x = jitter(grid[c(x[[i]], 21), 1], 1.5),
y = jitter(grid[c(x[[i]], 21), 2], 1.5), col = rgb(0, 0, 0, alpha = 0.002),
ylab = NULL, xlab = NULL)
}
}
points(grid$x, grid$y, col = c(rep(color, 20), color), pch = c(rep(19, 20), 17), cex = c(rep(1.5, 20), 2),
ylab = NULL, xlab = NULL)
box()
#axis(side = 2, pos = 0, at = grid$y[-nrow(grid)], labels = 1:(nrow(grid)-1), cex.axis = 0.75, las = 2)
}
png("posterior_bizniz.png", width = 6, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, plot_c, labels = c("", "C"), nrow = 1, rel_widths = c(1, 0.8))
dev.off()
plot_route <- function(x, color, label, buff = 0.2){
#par(mar = c(0, 2.4, 0, 0.2))
par(mar = c(0, 0, 0, 0))
plot(grid$x, grid$y, axes = FALSE, ylab = "", xlab = "", main = label, col = "white", cex.main = 0.8,
xlim = c(min(grid$x)-buff, max(grid$x)+buff),
ylim = c(min(grid$y)-buff, max(grid$y)+buff))
if(typeof(x[[1]]) == "logical"){
for(i in 1:length(x)){
lines(x = jitter(grid[c(which(x[[i]]), 21), 1], 1.5),
y = jitter(grid[c(which(x[[i]]), 21), 2], 1.5), col = rgb(0, 0, 0, alpha = 0.002),
ylab = NULL, xlab = NULL)
}
}
if(typeof(x[[1]]) == "double"){
for(i in 1:length(x)){
lines(x = jitter(grid[c(x[[i]], 21), 1], 1.5),
y = jitter(grid[c(x[[i]], 21), 2], 1.5), col = rgb(0, 0, 0, alpha = 0.002),
ylab = NULL, xlab = NULL)
}
}
points(grid$x, grid$y, col = c(rep(color, 20), color), pch = c(rep(19, 20), 17), cex = c(rep(1.5, 20), 2),
ylab = NULL, xlab = NULL)
box()
#axis(side = 2, pos = 0, at = grid$y[-nrow(grid)], labels = 1:(nrow(grid)-1), cex.axis = 0.75, las = 2)
}
png("common_routes_m.png", width = 2, height = 10, units = "in", res = 300)
plot_route(routes_norm_m_best[1:1000], "red", "")
dev.off()
png("posterior_bizniz.png", width = 6, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, plot_c, labels = c("", "C"), nrow = 1, rel_widths = c(1, 0.8))
dev.off()
plot_grid(plot_a_b, (ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")), labels = c("", "C", ""), nrow = 1, rel_widths = c(1, 0.8))
png("posterior_bizniz.png", width = 6, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
#plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, (ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")), labels = c("", "C", ""), nrow = 1, rel_widths = c(1, 0.8))
dev.off()
png("posterior_bizniz.png", width = 6, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
#plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, (ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")),
labels = c("", "C", ""), nrow = 1, rel_widths = c(1, 0.4))
dev.off()
png("posterior_bizniz.png", width = 4, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
#plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, (ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")),
labels = c("", "C", ""), nrow = 1, rel_widths = c(1, 0.4))
dev.off()
png("posterior_bizniz.png", width = 4, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
#plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, (ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")),
labels = c("", "C", ""), nrow = 1, rel_widths = c(1, 0.6))
dev.off()
png("posterior_bizniz.png", width = 4, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
#plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, (ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")),
labels = c("", "C", ""), nrow = 1, rel_widths = c(1, 0.8))
dev.off()
png("posterior_bizniz.png", width = 5, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
#plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, (ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")),
labels = c("", "C", ""), nrow = 1, rel_widths = c(1, 0.8))
dev.off()
png("posterior_bizniz.png", width = 5, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
#plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, (ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")),
labels = c("", "C", ""), nrow = 1, rel_widths = c(1, 0.7))
dev.off()
png("posterior_bizniz.png", width = 5, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
#plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, (ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")),
labels = c("", "C", ""), nrow = 1, rel_widths = c(1.1, 0.7))
dev.off()
png("posterior_bizniz.png", width = 5, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
#plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, (ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")),
labels = c("", "C", ""), nrow = 1, rel_widths = c(1.2, 0.7))
dev.off()
png("posterior_bizniz.png", width = 5, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
#plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, (ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")),
labels = c("", "C", ""), nrow = 1, rel_widths = c(1.2, 0.7), hjust = c(-2))
dev.off()
png("posterior_bizniz.png", width = 5, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
#plot_a_b <- plot_grid(plot_a, plot_b, nrow = 2, rel_heights = c(2, 1), labels = c("A", "B"))
plot_grid(plot_a_b, (ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")),
labels = c("", "C", ""), nrow = 1, rel_widths = c(1.2, 0.7), hjust = 2)
dev.off()
png("posterior_bizniz.png", width = 5, height = 4, units = "in", res = 300)
plot_a <- plot_grid((ggdraw() + draw_image("posterior_m.png")) / (ggdraw() + draw_image("posterior_w.png")))
plot_b <- ggdraw() + draw_image("holds_skipped.png")
plot_c <- plot_grid((ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")))
plot_grid(plot_a_b, (ggdraw() + draw_image("common_routes_m.png")) + (ggdraw() + draw_image("common_routes_w.png")),
labels = c("", "C", ""), nrow = 1, rel_widths = c(1.2, 0.7), hjust = 1)
dev.off()
test <- readRDS("~/Documents/Work/Summer_2021/Speed Climbing/SpeedClimbingABM/hpcc_output/params.RDS")
plot(density(test$innov_prob))
plot(density(test$learn_prob))
plot(density(test$max_dist))
plot(density(test$improve_min))
plot(density(test$improve_rate_m))
plot(density(test$innov_x_pop))
plot(density(test$innov_x_times))
plot(density(test$innov_prob))
test <- readRDS("~/Documents/Work/Summer_2021/Speed Climbing/SpeedClimbingABM/hpcc_output/params.RDS")
plot(density(test$innov_prob))
plot(density(test$learn_prob))
plot(density(test$max_dist))
plot(density(test$constraint))
test <- readRDS("~/Documents/Work/Summer_2021/Speed Climbing/SpeedClimbingABM/hpcc_output/params.RDS")
plot(density(test$innov_prob))
plot(density(test$learn_prob))
plot(density(test$max_dist))
test <- readRDS("~/Documents/Work/Summer_2021/Speed Climbing/SpeedClimbingABM/hpcc_output/params.RDS")
plot(density(test$innov_prob))
plot(density(test$learn_prob))
plot(density(test$max_dist))
plot(density(test$constraint))
plot(density(test$improve_rate_m))
plot(density(test$improve_rate_sd))
plot(density(test$improve_min))
plot(density(test$innov_prob))
test <- readRDS("~/Documents/Work/Summer_2021/Speed Climbing/SpeedClimbingABM/hpcc_output/params.RDS")
plot(density(test$innov_prob))
test <- readRDS("~/Documents/Work/Summer_2021/Speed Climbing/SpeedClimbingABM/hpcc_output/params.RDS")
plot(density(test$innov_prob))
plot(density(test$learn_prob))
plot(density(test$max_dist))
plot(density(test$constraint))
test <- readRDS("~/Documents/Work/Summer_2021/Speed Climbing/SpeedClimbingABM/hpcc_output/params.RDS")
plot(density(test$innov_prob))
plot(density(test$learn_prob))
plot(density(test$max_dist))
test <- readRDS("~/Documents/Work/Summer_2021/Speed Climbing/SpeedClimbingABM/hpcc_output/params.RDS")
plot(density(test$learn_prob))
plot(density(test$innov_prob))
test <- readRDS("~/Documents/Work/Summer_2021/Speed Climbing/SpeedClimbingABM/hpcc_output/params.RDS")
plot(density(test$innov_prob))
plot(density(test$learn_prob))
plot(density(test$max_dist))
plot(density(test$constraint))
plot(density(test$innov_x_times))
plot(density(test$innov_x_pop))
test <- readRDS("~/Documents/Work/Summer_2021/Speed Climbing/SpeedClimbingABM/hpcc_output/params.RDS")
plot(density(test$innov_prob))
plot(density(test$learn_prob))
plot(density(test$improve_min))
plot(density(test$max_dist))
plot(density(test$innov_x_times))
plot(density(test$innov_x_pop))
plot(density(test$learn_x_pop))
plot(density(test$learn_x_times))
plot(density(test$constraint))
plot(density(test$n_top))
plot(density(test$constraint))
plot(density(test$innov_prob))
test <- readRDS("~/Documents/Work/Summer_2021/Speed Climbing/SpeedClimbingABM/hpcc_output/params.RDS")
plot(density(test$innov_prob))
plot(density(test$constraint))
plot(density(test$improve_rate_sd))
plot(density(test$learn_prob))
plot(density(test$innov_prob))
#set working directory, load data, source code
setwd("~/Documents/Work/Summer_2021/Speed Climbing/SpeedClimbingABM")
load("data.RData")
grid <- read.csv("grid.csv")/1000
source("SpeedClimbingABM.R")
library(parallel)
#subset data by gender
data <- data[which(data$gender == "M"), ]
#get all unique climbers
uniq_climbers <- unique(data$athlete)
#separate continuous sequences of years
seqs <- lapply(uniq_climbers, function(x){split(data$year[which(data$athlete == x)], cumsum(seq_along(data$year[which(data$athlete == x)]) %in% (which(diff(data$year[which(data$athlete == x)]) > 1) + 1)))})
#for each unique climber, iterate through their sequences, and and extract their ID, start year, end year, and time in start year (separate row per sequence)
pop_data <- data.table::data.table(do.call(rbind, lapply(1:length(uniq_climbers), function(i){
t(sapply(1:length(seqs[[i]]), function(j){
c(uniq_climbers[i], min(unlist(seqs[[i]][j])), max(unlist(seqs[[i]][j])), data$time[which(data$athlete == uniq_climbers[i] & data$year == min(unlist(seqs[[i]][j])))])
}))
})))
colnames(pop_data) <- c("ID", "start", "end", "time")
pop_data
#get years
years <- sort(unique(data$year))
#get population sizes
n <- unlist(lapply(1:length(years), function(x){nrow(data[which(data$year == years[x]), ])}))
#load main simulation data
n_m <- 500
temp <- paste0("hpcc_output/simulations_m_fixed/_rslurm_", n_m)
params <- readRDS(paste0(temp, "/params.RDS"))
results <- c(unlist(readRDS(paste0(temp, "/results_0.RDS"))),
unlist(readRDS(paste0(temp, "/results_1.RDS"))),
unlist(readRDS(paste0(temp, "/results_2.RDS"))),
unlist(readRDS(paste0(temp, "/results_3.RDS"))),
unlist(readRDS(paste0(temp, "/results_4.RDS"))))
rm(temp)
#set number of simulations kept below tolerance level
tol <- 1000
#get posteriors to sample priors from
innov_prob_post <- density(params$innov_prob[order(results)[1:tol]], from = min(params$innov_prob[order(results)[1:tol]]), to = max(params$innov_prob[order(results)[1:tol]]))
learn_prob_post <- density(params$learn_prob[order(results)[1:tol]], from = min(params$learn_prob[order(results)[1:tol]]), to = max(params$learn_prob[order(results)[1:tol]]))
n_top_post <- density(params$n_top[order(results)[1:tol]], from = min(params$n_top[order(results)[1:tol]]), to = max(params$n_top[order(results)[1:tol]]))
max_dist_post <- density(params$max_dist[order(results)[1:tol]], from = min(params$max_dist[order(results)[1:tol]]), to = max(params$max_dist[order(results)[1:tol]]))
constraint_post <- density(params$constraint[order(results)[1:tol]], from = min(params$constraint[order(results)[1:tol]]), to = max(params$constraint[order(results)[1:tol]]))
improve_rate_m_post <- density(params$improve_rate_m[order(results)[1:tol]], from = min(params$improve_rate_m[order(results)[1:tol]]), to = max(params$improve_rate_m[order(results)[1:tol]]))
improve_rate_sd_post <- density(params$improve_rate_sd[order(results)[1:tol]], from = min(params$improve_rate_sd[order(results)[1:tol]]), to = max(params$improve_rate_sd[order(results)[1:tol]]))
#improve_min_post <- density(params$improve_min[order(results)[1:tol]], from = min(params$improve_min[order(results)[1:tol]]), to = max(params$improve_min[order(results)[1:tol]]))
#store number of simulations
n_sim <- 10000
#generate priors
priors <- data.frame(innov_prob = sample(innov_prob_post$x, n_sim, replace = TRUE, prob = innov_prob_post$y),
learn_prob = sample(learn_prob_post$x, n_sim, replace = TRUE, prob = learn_prob_post$y),
n_top = sample(n_top_post$x, n_sim, replace = TRUE, prob = n_top_post$y),
max_dist = sample(max_dist_post$x, n_sim, replace = TRUE, prob = max_dist_post$y),
constraint = sample(constraint_post$x, n_sim, replace = TRUE, prob = constraint_post$y),
improve_rate_m = sample(improve_rate_m_post$x, n_sim, replace = TRUE, prob = improve_rate_m_post$y),
improve_rate_sd = sample(improve_rate_sd_post$x, n_sim, replace = TRUE, prob = improve_rate_sd_post$y))
#improve_min = sample(improve_min_post$x, n_sim, replace = TRUE, prob = improve_min_post$y))
#run posterior simulations
posteriors <- mclapply(1:n_sim, function(x){
SpeedClimbingABM(n = n, years = years, pop_data = pop_data, grid = grid, n_holds = 20,
beta_true_prob = 1, innov_prob = priors$innov_prob[x], learn_prob = priors$learn_prob[x],
n_top = priors$n_top[x], max_dist = priors$max_dist[x], constraint = priors$constraint[x],
improve_rate_m = priors$improve_rate_m[x], improve_rate_sd = priors$improve_rate_sd[x],
improve_min = 0.5,
#improve_min = priors$improve_min[x],
sum_stats = FALSE, plot = FALSE, raw = TRUE)
}, mc.cores = 7)
# #run posterior simulations with innov_prob = 0.3 and learn_prob = 0.2
# posteriors_optim <- mclapply(1:n_sim, function(x){
#   SpeedClimbingABM(n = n, years = years, pop_data = pop_data, grid = grid, n_holds = 20,
#                    beta_true_prob = 1, innov_prob = 0.3, learn_prob = 0.2,
#                    n_top = priors$n_top[x], max_dist = priors$max_dist[x], constraint = priors$constraint[x],
#                    improve_rate_m = priors$improve_rate_m[x], improve_rate_sd = priors$improve_rate_sd[x],
#                    improve_min = priors$improve_min[x],
#                    sum_stats = FALSE, plot = FALSE, raw = TRUE)
# }, mc.cores = 7)
#posteriors_m <- list(norm = posteriors, optim = posteriors_optim)
posteriors_m <- list(norm = posteriors)
#save(posteriors_m, file = "hpcc_output/posteriors_m.RData")
save(posteriors_m, file = "hpcc_output/posteriors_m_fixed.RData")
